#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/outputs.h>

// For a full list of keycodes refer to
// zmk/app/include/dt-bindings/zmk/keys.h

// UK layout compatibility
#define UK_DOUBLE_QUOTES AT_SIGN
#define UK_AT_SIGN DOUBLE_QUOTES
#define UK_PIPE PIPE2
#define UK_TILDE TILDE2
#define UK_HASH NON_US_HASH
#define UK_BACKSLASH NON_US_BACKSLASH

&mt {
  flavor = "tap-preferred";
  tapping_term_ms = <250>;
  quick_tap_ms = <0>;
};

&lt {
  flavor = "tap-preferred";
  tapping_term_ms = <175>;
  quick_tap_ms = <0>;
};

/ {

  #include "combos.dtsi"

  behaviors {

    #include "macros.dtsi"

    quote: single_double_quotes {
      compatible = "zmk,behavior-mod-morph";
      label = "SINGLE_DOUBLE_QUOTES";
      #binding-cells = <0>;
      bindings = <&kp SINGLE_QUOTE>, <&kp UK_DOUBLE_QUOTES>;
      mods = <(MOD_LSFT|MOD_RSFT)>;
    };

    lst: layer_sticky_tap {
      compatible = "zmk,behavior-hold-tap";
      label = "LAYER_STICKY_TAP";
      #binding-cells = <2>;
      tapping-term-ms = <175>;
      quick_tap_ms = <0>;
      flavor = "tap-preferred";
      bindings = <&mo>, <&sk>;
    };

  };

  keymap {
    compatible = "zmk,keymap";

    default_layer {
      bindings = <

        // ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮   ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
             &kp Q         &kp W         &kp F         &kp P         &kp B             &kp J         &kp L         &kp U         &kp Y         &quote
        // ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
             &mt LALT A    &mt LSHFT R   &mt LCTRL S   &mt LGUI T    &kp G             &kp M         &mt LGUI N    &mt LCTRL E   &mt LSHFT I   &mt LALT O
        // ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
             &lt 3 Z       &kp X         &kp C         &kp D         &kp V             &kp K         &kp H         &kp COMMA     &kp DOT       &lt 3 SLASH
        // ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
                                                       &kp ESCAPE    &lt 1 SPC         &lst 2 LSHFT  &kp ENTER
                                                  // ╰─────────────┴─────────────╯   ╰─────────────┴─────────────╯
      >;
    };

    number_layer {
      bindings = <

        // ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮   ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
             &none         &none         &none         &none         &none             &none         &kp N7        &kp N8        &kp N9        &none
        // ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
             &sk LALT      &sk LSHFT     &sk LCTRL     &sk LGUI      &none             &none         &kp N4        &kp N5        &kp N6        &kp N0
        // ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
             &none         &none         &none         &none         &none             &none         &kp N1        &kp N2        &kp N3        &none
        // ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
                                                       &trans        &trans            &kp N0        &trans
                                                  // ╰─────────────┴─────────────╯   ╰─────────────┴─────────────╯
      >;
    };

    navigation_layer {
      bindings = <

        // ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮   ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
             &none         &kp BSPC      &kp UP        &kp TAB       &none             &none         &none         &none         &kp ESCAPE    &none
        // ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
             &none         &kp LEFT      &kp DOWN      &kp RIGHT     &none             &none         &sk LGUI      &sk LCTRL     &sk LSHFT     &sk LALT
        // ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
             &none         &none         &none         &none         &none             &none         &none         &none         &none         &none
        // ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
                                                       &trans        &kp ENTER         &trans        &trans
                                                  // ╰─────────────┴─────────────╯   ╰─────────────┴─────────────╯
      >;
    };

    adjust_layer {
      bindings = <

        // ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮   ╭─────────────┬─────────────┬─────────────┬─────────────┬─────────────╮
             &none         &none         &kp C_VOL_UP  &none         &none             &none         &none         &none         &none         &none
        // ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
             &none         &kp C_BRI_DN  &kp C_VOL_DN  &kp C_BRI_UP  &none             &none         &out OUT_TOG  &reset        &bootloader   &none
        // ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
             &none         &none         &none         &none         &none             &none         &bt BT_SEL 0  &bt BT_SEL 1  &bt BT_SEL 2  &bt BT_CLR
        // ╰─────────────┴─────────────┴─────────────┼─────────────┼─────────────┤   ├─────────────┼─────────────┼─────────────┴─────────────┴─────────────╯
                                                       &trans        &trans            &trans        &trans
                                                  // ╰─────────────┴─────────────╯   ╰─────────────┴─────────────╯
      >;
    };

  };
};
